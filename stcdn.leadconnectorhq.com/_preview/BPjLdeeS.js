import{u as O,P as g,d as m,E as h}from"./CFkpPN2T.js";const _=(e,s,a,l,t)=>{let n=[];return a&&(a==null||a.map(i=>{if(i.selectedPrice._id===s.selectedPrice._id)if(e==="sub"){if(i.quantity===1||t===0)return;i.quantity=t||i.quantity-1}else i.quantity=t||i.quantity+1;n.push(i)})),h(`cart_details_${l}`,JSON.stringify({products:n})),n},w=e=>{if(!e.length)return 0;let s=0;return e.forEach(a=>{s+=k(a)*a.quantity}),s},B=e=>(e==null?void 0:e.availableQuantity)<=0&&e.trackInventory&&!e.allowOutOfStockPurchases,R=async e=>{const s=O();try{const{data:a}=await g.getAllCollectionsByLocation({altId:s.value.locationId,altType:"location",collectionIds:e.join()});return a}catch(a){console.error("Error caught: ",a.message)}},q=(e,s)=>{var a;return(a=e==null?void 0:e.medias)==null?void 0:a.find(l=>{var t;return(t=l==null?void 0:l.priceIds)==null?void 0:t.includes(s)})},A=e=>e.filter(s=>s.selectedPrice.type==="recurring").length>1,k=e=>{let s=e.selectedPrice.amount;return e.selectedPrice.trialPeriod&&(s=0),s+(e.selectedPrice.setupFee??0)},C=async(e,s)=>{let a=e==null?void 0:e.map(t=>{var n;return(n=t==null?void 0:t.selectedPrice)==null?void 0:n._id}).join(",");const l=await g.getSelectedProductPrices({locationId:s,ids:a});return e=e==null?void 0:e.map(t=>{const n=l.find(i=>i._id===t.selectedPrice._id);if(n&&t.quantity>=n.availableQuantity&&n.trackInventory&&!n.allowOutOfStockPurchases)return t.name=n.product.name,t.selectedPrice.name=n.name,t.selectedPrice.amount=n.amount,t.selectedPrice.currency=n.currency,n.availableQuantity===0?(t.status="Out of stock",t.isDeleted=!0,t.completelyOutOfStock=!0,t.disablePlusButton=!0,t.disableMinusButton=!1,t):(t.status=`Only ${n.availableQuantity} in stock`,t.completelyOutOfStock=!1,t.isDeleted=!0,t.prevQuantity=t.quantity,t.quantity=n.availableQuantity,t.disablePlusButton=!0,t.disableMinusButton=!1,t);if(t.disablePlusButton=!1,!n){t.status="Out of stock",t.isDeleted=!0,t.completelyOutOfStock=!0,t.disablePlusButton=!0,t.disableMinusButton=!1;return}return t.status="",t.isDeleted=!1,t.name=n.product.name,t.selectedProductImage=t.selectedProductImage??n.product.image,t.selectedPrice.name=n.name,t.selectedPrice.amount=n.amount,t.selectedPrice.currency=n.currency,t.selectedPrice.recurring=t.selectedPrice.recurring,t.selectedPrice.setupFee=t.selectedPrice.setupFee,t.selectedPrice.trialPeriod=t.selectedPrice.trialPeriod,t.disableMinusButton=t.quantity<=1,t}).filter(Boolean),e},F=e=>e.map(a=>a.completelyOutOfStock).includes(!0),Q=e=>e.map(a=>a.isCompletelyOutOfStock).includes(!0),L=e=>`${((e.compareAtPrice-e.amount)*100/e.compareAtPrice).toFixed(0)}% off`,j=e=>e.carrierRateId?e.carrierRateId:e._id,E=async(e,s,a,l,t,n,i,o,u,f,P,d)=>{const y=O(),r={limit:e,offset:s,locationId:y.value.locationId,collectionSlug:a,storeId:y.value.funnelId,sendWishlistStatus:d};l&&(r.q=encodeURIComponent(l)),t&&(r.advancedSearch=t),n&&(r.availability=n),i&&(r.minPrice=i),o&&(r.maxPrice=o),u&&(r.sortField=u),f&&(r.sortOrder=f),P&&(r.productIds=P.join(","));try{return await g.getStoreProducts(r)}catch(c){console.error("Error while fetching products: ",c)}},M=e=>{var s,a,l,t,n;if(e.isLabelEnabled&&((s=e.label)!=null&&s.title)){let i=!0;return(a=e.label)!=null&&a.startDate&&(i=m().isAfter(m((l=e.label)==null?void 0:l.startDate))),(t=e.label)!=null&&t.endDate&&(i=i&&m().isBefore(m((n=e.label)==null?void 0:n.endDate))),i}},T=(e,s,a)=>{var l,t,n,i,o,u,f,P,d,y,r;return(l=e==null?void 0:e.cartDetails)==null||l.products.push(s),e.total+=(n=(t=a.value)==null?void 0:t.order)==null?void 0:n.amount,e.taxDetails=(u=(o=(i=a.value)==null?void 0:i.order)==null?void 0:o.taxSummary)==null?void 0:u.map(c=>{var S;const b=(S=e==null?void 0:e.taxDetails)==null?void 0:S.find(v=>v._id===c._id);return b?{...b,amount:b.amount+c.amount}:c}),e.shippingRate?e.shippingRate.amount+=((d=(P=(f=a.value)==null?void 0:f.order)==null?void 0:P.shippingRate)==null?void 0:d.amount)??0:e.shippingRate=(r=(y=a.value)==null?void 0:y.order)==null?void 0:r.shippingRate,e},U=(e,s,a)=>{var l;if(!e)return"";try{const t=(l=window.libphonenumber)==null?void 0:l.parsePhoneNumberFromString(e,s);return t&&t.isValid()?a?t.formatInternational():t.formatNational():e}catch{return e}},$=(e,s)=>{const a=O(),l=s.filter(t=>{var n,i;return((n=t.selectedPrice)==null?void 0:n._id)!==((i=e.selectedPrice)==null?void 0:i._id)});return a.value.cartItems=l,h(`cart_details_${a.value.funnelId}`,JSON.stringify({products:l})),l},N=async e=>{const s=O();return await g.getStoreProductById({productId:e,locationId:s.value.locationId,sendWishlistStatus:!!s.value.customerLoginToken})};export{L as a,k as b,C as c,$ as d,N as e,E as f,R as g,A as h,B as i,q as j,w as k,F as l,Q as m,U as n,j as o,T as p,M as s,_ as u};
