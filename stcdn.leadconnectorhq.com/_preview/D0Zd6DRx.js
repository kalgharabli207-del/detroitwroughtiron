import{S as O,T as _,y as I,E as F}from"./BJulYKC0.js";import{u as N,E as W,G as y,s as j,H,r as Q,I as z,J,K as M,L as B}from"./CFkpPN2T.js";import{S as G}from"./LMdvGtSd.js";function $(r){const c=r.split("/");return c.includes("v2")||c.includes("preview")}function oe(r,c){}function re(r,c){var g,w;if(!((g=Object.keys(c??{}))!=null&&g.length))return r;const h=new URL(r);return(w=Object.keys(c))==null||w.forEach(S=>{h.searchParams.append(S,c[S])}),h==null?void 0:h.href}const ae=()=>{const r=N(),c=O(),h=_(),{$bus:g}=I();function w(){return window.location.search}function S(e){e&&(e=e.replace("tel:",""),window.location.href="tel://"+e)}function k(e){e&&(e=e.replace("sms:",""),window.location.href="sms://"+e)}function E(e){e&&(e=e.replace("mailto:",""),window.location.href="mailto:"+e)}function b(e,n){const t=`_mf_${e}`,o=JSON.stringify(n),i=F(t,{path:"/",maxAge:31536e3});i.value=o,W(t,o)}function x(e){const{extra:n}=e;r.value.videoExistsInPage&&g.$emit("handle-redirect"),n.action.value==="go-to-next-funnel-step"?v():n.action.value==="url"&&p(n.visitWebsite.value)}function v(e,n=!1,t){r.value.videoExistsInPage&&g.$emit("handle-redirect");try{const o=c.path.split("/"),i=r.value.funnelSteps||[],a=e?y({funnelSteps:i,stepId:e}):y({funnelSteps:i,funnelNextStep:r.value.funnelNextStep});let l=a==null?void 0:a.url;(o.includes("v2")||o.includes("preview"))&&(l=a?`/v2/preview/${a.id}`:""),t&&(l+=`/product/${t}`);const f=r.value.funnelDomain;if(window.location.hostname!=="localhost"&&!(o.includes("v2")||o.includes("preview"))&&f!==window.location.hostname){const s=`https://${f}${l}`+w();p({url:s,newTab:n})}else{if(n){const s=h.resolve({path:l});window.open(s.href+w(),"_blank");return}window.location.href=l+w();return}}catch(o){console.error(o)}}function p({url:e,newTab:n}){r.value.videoExistsInPage&&g.$emit("handle-redirect"),e=j(e);let t=r.value.locationId;const o=H(t);o&&(e=Q(e,o)),n?window.open(e,"_blank")===null&&(window.location.href=e):window.location.href=e}const L=async({fileUrl:e,fileName:n})=>{try{const t=await fetch(e,{mode:"cors"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.blob(),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i;const l=u=>{const d=u.indexOf(".");return d>0?u.substring(0,d):u},f=n.trim()||"download",s=l(f);a.download=s,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(i)}catch(t){console.error("Download failed:",t)}},m=(e,n=!0,t)=>{try{const o=c.path.split("/"),i=r.value.funnelSteps||[],a=c.query,l=y({funnelSteps:i,stepId:e});if(l&&!l.id)return"#";if(o.includes("v2")||o.includes("preview")){let d="";return l&&(d=`/v2/preview/${l.id}`),t&&(d+=`/product/${t}`),d}let f=l==null?void 0:l.url;delete a.domain,delete a.page_url,delete a.additional_route,delete a.step_id,delete a.funnel_id,delete a.page_id;const s=r.value.funnelDomain;t&&(f+=`/product/${t}`);const u=new URL(f,`https://${s}`);return n&&Object.keys(a).forEach(d=>{u.searchParams.append(d,a[d])}),z({url:u.href})}catch{return"#"}},R=(e,n,t)=>{if(w()){e==null||e.preventDefault();const i=m(n,!0);t?window.open(i,"_blank")===null&&(window.location.href=i):window.location.href=i}},T=()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-product-list");e&&v(e==null?void 0:e.value)},U=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-detail");n&&v(n==null?void 0:n.value,!1,e)},A=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-detail");if(n)return m(n==null?void 0:n.value,!1,e)},C=()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-product-list");return e?$(window.location.pathname)?`${window.location.origin}/v2/preview/${e==null?void 0:e.id}`:`https://${r.value.funnelDomain}${e.url}`:""},D=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-list");return!n||$(c.path)?"":`https://${r.value.funnelDomain}${n.url}/store/account/${e}`},P=e=>{var t;const n=(t=r.value.funnelSteps)==null?void 0:t.find(o=>(o==null?void 0:o.key)==="store-product-list");if(!n||$(c.path))return"";p({url:`https://${r.value.funnelDomain}${n.url}/store/account/${e}`,newTab:!1})};return{call:S,sms:k,mailTo:E,createMembershipToken:b,goToNextFunnelStep:v,openUrl:p,downloadFile:L,getNextFunnelStepURL:m,redirectOnSubmit:x,goToEcomPrdouctListPage:T,goToEcomCartPage:()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-cart");e&&v(e==null?void 0:e.value)},redirectAction:(e,n,t,o,i,a,l)=>{try{const{saleAction:f,stepPath:s,visitWebsite:u}=e;J(n.value.funnelId,t,l),M(n.value.funnelId);const d={name:o.fullName,addressLine1:o.address,city:o.city,state:o.state,zip:o.zipcode,country:o.country};if(B(n.value.funnelId,d),!f)if(n.value.funnelNextStep){v();return}else throw new Error("Redirect not handled");switch(f.value){case"url":if(u&&u.value&&u.value.url){p(u.value);break}else throw new Error("Redirect not handled");case"step-path":if(s&&s.value){v(s.value);break}else throw new Error("Redirect not handled");case"go-to-next-funnel-step":if(n.value.funnelNextStep){v();break}else throw new Error("Redirect not handled")}}catch(f){if(console.error(f),i)alert(a);else{const s=JSON.parse(localStorage.getItem("_ud")||"{}"),u=[G.sepa].includes(localStorage.getItem(`pmt_${n.value.funnelId}_${s==null?void 0:s.id}`)||"")?"We are proccessing your order with the bank. We'll confirm you order after bank's confirmation.":`Order successfully placed! 
 However, Something went wrong while displaying this webpage, please contact the seller.`;alert(u)}}},getEcomProductListPageUrl:C,goToStep:R,goToEcomCheckoutPage:()=>{var n;const e=(n=r.value.funnelSteps)==null?void 0:n.find(t=>(t==null?void 0:t.key)==="store-checkout");e&&v(e==null?void 0:e.value)},getEcomProductListPagePath:e=>{var o;const n=(o=r.value.funnelSteps)==null?void 0:o.find(i=>(i==null?void 0:i.key)==="store-product-list");if(!n)return"";let t="";return $(c.path)?t=`/v2/preview/${n==null?void 0:n.id}`:t=`https://${r.value.funnelDomain}${n.url}`,e&&(t+=`/collections/${e}`),t},goToEcomPrdouctDetailPage:U,getRedirectActionUrl:e=>{var i;const{saleAction:n,stepPath:t,visitWebsite:o}=e;if(!n)return r.value.funnelNextStep?m():"";switch(n.value){case"url":return((i=o==null?void 0:o.value)==null?void 0:i.url)??"";case"step-path":return t!=null&&t.value?m(t.value):"";case"go-to-next-funnel-step":{const a=r.value.funnelSteps||[],l=y({funnelSteps:a,funnelNextStep:r.value.funnelNextStep});return r.value.funnelNextStep&&(l!=null&&l.value)?m(l.value):""}default:return""}},getEcomProductDetailURL:A,getCustomerAccessCenterUrl:D,goToCustomerAccessCenter:P,goToCustomerAccessCenterLogin:()=>{sessionStorage.setItem("redirect",window.location.href),P("login")}}};export{re as a,oe as g,$ as i,ae as u};
